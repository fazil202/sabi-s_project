<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Seating Plan</title>
    <link rel="stylesheet" href="/static/style.css" />
    <link rel="stylesheet" href="/static/seating plan/seating_plan.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Segoe UI", Arial, sans-serif;
        background: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%);
        margin: 0;
        padding: 0;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        h1 {
          margin-top: 40px;
          color: #1a237e;
          font-size: 2.5em;
          letter-spacing: 1px;
          text-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
          text-align: center;
        }
        .download-btn {
          margin: 28px auto 0 auto;
          padding: 12px 32px;
          background: linear-gradient(90deg, #007bff 60%, #00c6ff 100%);
          color: #fff;
          border: none;
          border-radius: 8px;
          font-size: 18px;
          cursor: pointer;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
          transition: background 0.2s, transform 0.2s;
          display: block;
        }
        .download-btn:hover {
          background: linear-gradient(90deg, #0056b3 60%, #0093c4 100%);
          transform: translateY(-2px) scale(1.03);
        }
        .room-card {
          background: #fff;
          box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
          border-radius: 16px;
          margin: 40px auto;
          padding: 32px 40px;
          max-width: 850px;
          display: flex;
          flex-direction: row;
          flex-wrap: wrap;
          align-items: center;
          border-top: 6px solid #007bff;
          position: relative;
        }
        .seating-section {
          flex: 1;
          width: 800px;
          flex-wrap: wrap;
          display: flex;
          gap: 20px;
          margin: 10px;
        }
        .main-content {
          display: flex;
          flex-direction: row;
          justify-content: center;

          gap: 20px;
          margin: 0 auto;
          align-items: flex-start;
        }

        .unseated-section {
          width: fit-content;
          height: fit-content;
          margin: 40px 0px;
          background: #fff;
          box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
          border-radius: 16px;
          padding: 20px;
          border-top: 6px solid #dc3545;
          /* position: sticky; */
          top: 20px;
          overflow-y: auto;
        }
        .unseated-title {
          font-size: 1.4em;
          color: #dc3545;
          margin-bottom: 16px;
          font-weight: 600;
          text-align: center;
        }
        .unseated-count {
          background: linear-gradient(135deg, #dc3545 0%, #e74c3c 100%);
          color: white;
          padding: 8px 16px;
          border-radius: 20px;
          font-size: 0.9em;
          font-weight: 600;
          text-align: center;
          margin-bottom: 16px;
        }
        .unseated-student {
          background: linear-gradient(135deg, #f8d7da 60%, #fff0f3 100%);
          border: 1px solid #f5c6cb;
          border-radius: 8px;
          padding: 12px;
          display: flex;
          flex-direction: column;
          /* justify-items: center; */
          align-items: center;
          margin-bottom: 8px;
          width: fit-content;
          font-size: 0.9em;
        }
        .unseated-student .roll {
          font-weight: bold;
          color: #721c24;
          font-size: 1em;
        }
        .unseated-student .name {
          color: #721c24;
          margin: 2px 0;
        }
        .unseated-student .branch {
          color: #a94442;
          font-size: 0.85em;
          font-style: italic;
        }
        .room-title {
          font-size: 2em;
          color: #007bff;
          margin-bottom: 24px;
          font-weight: 600;
          letter-spacing: 0.5px;
        }
        .seating-table {
          border-collapse: collapse;
          margin: 0 auto;
          width: 100%;
        }
        .seating-table td {
          padding: 0;
        }
        .seat-card {
          background: linear-gradient(135deg, #e9ecef 60%, #f7fafc 100%);
          border-radius: 6px;
          margin: 5px;
          padding: 8px;
          /* min-width: 120px;
        min-height: 60px; */
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          text-align: center;
          box-shadow: 0 1px 4px rgba(0, 0, 0, 0.07);
          font-size: 14px;
          color: #222;
          transition: box-shadow 0.2s, transform 0.2s;
          position: relative;
        }
        .seat-card.multiple-students {
          min-height: 80px;
          padding: 6px;
        }
        .student-info {
          margin-bottom: 4px;
          padding: 2px 0;
          border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        .student-info:last-child {
          border-bottom: none;
          margin-bottom: 0;
        }
        .student-info .roll {
          font-weight: bold;
          color: #1a237e;
          font-size: 1em;
        }
        .student-info .name {
          font-size: 0.9em;
          color: #495057;
        }
        .student-info .branch {
          font-size: 0.8em;
          color: #6c757d;
        }
        .seat-card strong {
          color: #1a237e;
          font-size: 1.2em;
        }
        .seat-card:hover {
          box-shadow: 0 4px 12px rgba(0, 123, 255, 0.12);
          transform: scale(1.03);
          z-index: 2;
        }
        .seat-card.empty {
          background: linear-gradient(135deg, #f8d7da 60%, #fff0f3 100%);
          color: #a94442;
          font-style: italic;
          border: 2px dashed #f5c6cb;
        }
        .legend {
          margin: 32px auto 0 auto;
          /* max-width: 200px; */
          background: #fff;
          border-radius: 8px;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.07);
          padding: 18px 24px;
          font-size: 1em;
          color: #555;
          display: flex;
          flex-direction: row;
          width: 300px;
          gap: 40px;
          justify-content: center;
        }
        .legend-item {
          display: flex;
          align-items: center;
          gap: 8px;
        }
        .legend-color {
          width: 28px;
          height: 28px;
          border-radius: 6px;
          display: inline-block;
        }
        .legend-color.seat {
          background: linear-gradient(135deg, #e9ecef 60%, #f7fafc 100%);
          border: 1px solid #b0bec5;
        }
        .legend-color.empty {
          background: linear-gradient(135deg, #ff5765 60%, #f5486b 100%);
          border: 1px solid #ff6c7b;
        }
        @media (max-width: 1200px) {
          .main-content {
            flex-direction: column;
            gap: 20px;
          }
          .unseated-section {
            width: 100%;
            position: static;
            max-height: none;
            order: -1;
          }
        }
        @media (max-width: 900px) {
          .room-card {
            max-width: 98vw;
            padding: 18px 6vw;
          }
          .seating-table {
            border-spacing: 10px 8px;
          }
          .seat-card {
            min-width: 100px;
            min-height: 70px;
            font-size: 12px;
            padding: 6px;
          }
          .seat-card.multiple-students {
            min-height: 90px;
            font-size: 11px;
          }
          .student-info .roll {
            font-size: 0.9em;
          }
          .student-info .name {
            font-size: 0.8em;
          }
          .student-info .branch {
            font-size: 0.7em;
          }
          .unseated-section {
            padding: 16px;
          }
          .unseated-student {
            padding: 10px;
          }
        }
      }
    </style>
  </head>
  <body>
    {% with messages = get_flashed_messages() %} {% if messages %}
    <div
      id="toast-container"
      style="position: fixed; top: 20px; right: 20px; z-index: 9999"
    >
      {% for message in messages %}
      <div
        class="toast-message"
        style="
          background: #333;
          color: #fff;
          padding: 1rem 2rem;
          border-radius: 6px;
          margin-bottom: 10px;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
          min-width: 220px;
          font-size: 1.1em;
        "
      >
        {{ message }}
      </div>
      {% endfor %}
    </div>
    <script>
      setTimeout(function () {
        var container = document.getElementById("toast-container");
        if (container) container.style.display = "none";
      }, 4000);
    </script>
    {% endif %} {% endwith %}
    <h1>Exam Seating Arrangement</h1>
    <div
      style="
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-bottom: 20px;
      "
    >
      <form method="GET" action="/download_pdf">
        <button type="submit" class="download-btn">
          Download Seating Plan as PDF
        </button>
      </form>
      <form
        method="POST"
        action="{{url_for('pdf_history')}}"
        style="display: inline"
      >
        <input type="hidden" name="recipient_type" value="faculty" />
        <input type="hidden" name="pdf_id" value="{{ pdf_id }}" />
        <button
          type="submit"
          class="download-btn"
          style="background: linear-gradient(90deg, #28a745 60%, #00c851 100%)"
        >
          View history
        </button>
      </form>
    </div>
    <div class="legend">
      <div class="legend-item">
        <span class="legend-color seat"></span> Assigned Seat
      </div>
      <div class="legend-item">
        <span class="legend-color empty"></span> Empty Seat
      </div>
    </div>

    <div class="main-content">
      <!-- Seating Plan Section -->
      <div class="seating-section">
        {% if seating_plan %} {% for room in seating_plan %}
        <div class="room-card">
          <div class="room-title">Room {{ room.room_name }}</div>
          <table class="seating-table">
            {% for row in room.seats %}
            <tr>
              {% for desk in row %}
              <td>
                <div
                  class="seat-card {% if desk is none %}empty{% elif desk is iterable and desk is not string and desk is not mapping %}multiple-students{% endif %}"
                >
                  {% if desk is none %} Empty {% elif desk is iterable and desk
                  is not string and desk is not mapping %}
                  <!-- Multiple students per desk (list) -->
                  {% for student in desk %}
                  <div class="student-info">
                    <div class="roll">{{ student.roll_number }}</div>
                    <div class="name">{{ student.name }}</div>
                    <div class="branch">{{ student.branch }}</div>
                  </div>
                  {% endfor %} {% else %}
                  <!-- Single student per desk (dictionary) -->
                  <div class="student-info">
                    <div class="roll">{{ desk.roll_number }}</div>
                    <div class="name">{{ desk.name }}</div>
                    <div class="branch">{{ desk.branch }}</div>
                  </div>
                  {% endif %}
                </div>
              </td>
              {% endfor %}
            </tr>
            {% endfor %}
          </table>
        </div>
        {% endfor %} {% else %}
        <p
          style="
            margin-top: 40px;
            font-size: 1.2em;
            color: #a94442;
            text-align: center;
          "
        >
          No seating plan generated yet.
        </p>
        {% endif %}
      </div>
    </div>
    {% if unseated_students and unseated_students|length > 0 %}
    <div class="unseated-section">
      <div class="unseated-title">
        <i class="fas fa-exclamation-triangle"></i> Unseated Students
      </div>
      <div class="unseated-count">
        {{ unseated_students|length }} student{% if unseated_students|length !=
        1 %}s{% endif %} could not be seated
      </div>

      <div
        style="
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
          gap: 8px;
          align-items: center;
        "
      >
        {% for student in unseated_students %}
        <div class="unseated-student">
          <div class="roll">{{ student.roll_number }}</div>
          <div class="name">{{ student.name }}</div>
          <div class="branch">{{ student.branch }}</div>
        </div>
        {% endfor %}
      </div>

      <div
        style="
          margin-top: 16px;
          padding: 12px;
          background: #fff3cd;
          border: 1px solid #ffeaa7;
          border-radius: 6px;
          font-size: 0.8em;
          color: #856404;
        "
      >
        <strong>Note:</strong> These students couldn't be seated due to room
        capacity or seating constraints. Consider adding more rooms or adjusting
        constraints.
      </div>
    </div>
    {% endif %}
    <!-- Unseated Students Section -->
  </body>
</html>
